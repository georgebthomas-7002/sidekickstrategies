<!--
  templateType: blog_listing
  label: Blog Listing
  isAvailableForNewContent: true
  screenshotPath: ../images/template-previews/blog-listing.png
-->
{% extends "../layouts/base.html" %}

{% block body %}
<main class="blog-listing">
  {# Blog Header #}
  <section class="blog-listing__header">
    <div class="container">
      <h1 class="blog-listing__title">{{ group.public_title|default("Blog") }}</h1>
      {% if group.description %}
        <p class="blog-listing__description">{{ group.description }}</p>
      {% endif %}

      {# Topic Filter #}
      {% set topics = blog_topics(group.id, 250) %}
      {% if topics %}
        <nav class="blog-listing__topics" aria-label="Filter by topic">
          <a href="{{ group.absolute_url }}" class="blog-listing__topic-link {% if not topic %}blog-listing__topic-link--active{% endif %}">
            All
          </a>
          {% for t in topics %}
            <a href="{{ blog_tag_url(group.id, t.slug) }}" class="blog-listing__topic-link {% if topic and topic.slug == t.slug %}blog-listing__topic-link--active{% endif %}">
              {{ t.name }}
            </a>
          {% endfor %}
        </nav>
      {% endif %}
    </div>
  </section>

  {# Blog Content #}
  <section class="blog-listing__content">
    <div class="container">
      <div class="blog-listing__layout">
        {# Posts Grid #}
        <div class="blog-listing__posts">
          {% if contents %}
            <div class="blog-listing__grid">
              {% for post in contents %}
                <article class="blog-card">
                  {# Featured Image #}
                  <a href="{{ post.absolute_url }}" class="blog-card__image-link">
                    <div class="blog-card__image-wrapper">
                      {% if post.featured_image %}
                        <img
                          src="{{ post.featured_image }}"
                          alt="{{ post.featured_image_alt_text|default(post.name) }}"
                          class="blog-card__image"
                          loading="lazy"
                        >
                      {% else %}
                        <div class="blog-card__placeholder">
                          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                            <polyline points="21 15 16 10 5 21"></polyline>
                          </svg>
                        </div>
                      {% endif %}
                    </div>
                  </a>

                  <div class="blog-card__content">
                    {# Category #}
                    {% if post.topic_list %}
                      <div class="blog-card__category">
                        {% for topic in post.topic_list %}
                          <a href="{{ blog_tag_url(group.id, topic.slug) }}" class="blog-card__category-link">
                            {{ topic.name }}
                          </a>
                          {% if not loop.last %}<span class="blog-card__category-sep">,</span>{% endif %}
                        {% endfor %}
                      </div>
                    {% endif %}

                    {# Title #}
                    <h2 class="blog-card__title">
                      <a href="{{ post.absolute_url }}" class="blog-card__title-link">
                        {{ post.name }}
                      </a>
                    </h2>

                    {# Excerpt #}
                    {% set excerpt = post.post_summary|default(post.post_body|striptags|truncate(150, true, "...")) %}
                    <p class="blog-card__excerpt">{{ excerpt|truncate(150, true, "...") }}</p>

                    {# Meta #}
                    <div class="blog-card__meta">
                      {% if post.blog_author %}
                        <div class="blog-card__author">
                          {% if post.blog_author.avatar %}
                            <img src="{{ post.blog_author.avatar }}" alt="{{ post.blog_author.display_name }}" class="blog-card__author-image" loading="lazy">
                          {% else %}
                            <div class="blog-card__author-placeholder">{{ post.blog_author.display_name|first|upper }}</div>
                          {% endif %}
                          <span class="blog-card__author-name">{{ post.blog_author.display_name }}</span>
                        </div>
                      {% endif %}
                      <div class="blog-card__details">
                        {% if post.publish_date %}
                        <time class="blog-card__date" datetime="{{ post.publish_date|datetimeformat('%Y-%m-%d') }}">
                          {{ post.publish_date|datetimeformat('%B %d, %Y') }}
                        </time>
                        {% endif %}
                        {% set word_count = post.post_body|striptags|wordcount %}
                        {% set read_time = (word_count / 200)|round(0, 'ceil')|int %}
                        {% if read_time < 1 %}{% set read_time = 1 %}{% endif %}
                        <span class="blog-card__dot">&middot;</span>
                        <span class="blog-card__read-time">{{ read_time }} min read</span>
                      </div>
                    </div>
                  </div>
                </article>
              {% endfor %}
            </div>

            {# Pagination #}
            {% if contents.total_page_count > 1 %}
              <nav class="blog-listing__pagination" aria-label="Blog pagination">
                {% if contents.has_previous_page %}
                  <a href="{{ blog_page_link(previous_page) }}" class="pagination__link pagination__link--prev">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                    Previous
                  </a>
                {% endif %}

                <div class="pagination__pages">
                  {% for page_num in contents|paging_links %}
                    {% if page_num == "..." %}
                      <span class="pagination__ellipsis">...</span>
                    {% else %}
                      <a href="{{ blog_page_link(page_num) }}" class="pagination__page {% if page_num == current_page_num %}pagination__page--active{% endif %}">
                        {{ page_num }}
                      </a>
                    {% endif %}
                  {% endfor %}
                </div>

                {% if contents.has_next_page %}
                  <a href="{{ blog_page_link(next_page) }}" class="pagination__link pagination__link--next">
                    Next
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                  </a>
                {% endif %}
              </nav>
            {% endif %}
          {% else %}
            <div class="blog-listing__empty">
              <p>No posts found.</p>
            </div>
          {% endif %}
        </div>

        {# Sidebar #}
        <aside class="blog-listing__sidebar">
          {% module "blog_sidebar"
            path="@hubspot/blog_sidebar",
            label="Blog Sidebar"
          %}
        </aside>
      </div>
    </div>
  </section>
</main>
{% endblock body %}

{% block body_classes %}blog-listing-page{% endblock %}
