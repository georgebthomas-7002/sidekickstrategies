{# Image Gallery Module #}

{% set section_classes = "image-gallery-section" %}
{% set section_classes = section_classes ~ " image-gallery--bg-" ~ module.style_group.background %}
{% set section_classes = section_classes ~ " image-gallery--padding-" ~ module.style_group.padding %}
{% set section_classes = section_classes ~ " image-gallery--" ~ module.layout_group.layout %}
{% set section_classes = section_classes ~ " image-gallery--cols-" ~ module.layout_group.columns %}
{% set section_classes = section_classes ~ " image-gallery--gap-" ~ module.layout_group.gap %}
{% set section_classes = section_classes ~ " image-gallery--ratio-" ~ module.layout_group.aspect_ratio %}
{% set section_classes = section_classes ~ " image-gallery--radius-" ~ module.style_group.image_border_radius %}
{% set section_classes = section_classes ~ " image-gallery--hover-" ~ module.interaction_group.hover_effect %}
{% set section_classes = section_classes ~ " image-gallery--caption-" ~ module.interaction_group.caption_position %}

{% if module.interaction_group.enable_lightbox %}
  {% set section_classes = section_classes ~ " image-gallery--lightbox" %}
{% endif %}

{% if module.style_group.background == "dark" %}
  {% set section_classes = section_classes ~ " image-gallery--text-light" %}
{% else %}
  {% set section_classes = section_classes ~ " image-gallery--text-dark" %}
{% endif %}

<section class="{{ section_classes }}">
  <div class="container">
    {# Section Header #}
    {% if module.header_group.show_header %}
      <div class="image-gallery__header">
        {% if module.header_group.heading %}
          <{{ module.header_group.heading_level }} class="image-gallery__heading">
            {{ module.header_group.heading }}
          </{{ module.header_group.heading_level }}>
        {% endif %}

        {% if module.header_group.subheading %}
          <p class="image-gallery__subheading">{{ module.header_group.subheading }}</p>
        {% endif %}
      </div>
    {% endif %}

    {# Gallery Grid #}
    <div class="image-gallery__grid" role="list">
      {% for item in module.images %}
        <figure class="image-gallery__item" role="listitem">
          {% set has_link = item.link.url.href and not module.interaction_group.enable_lightbox %}

          {% if has_link %}
            <a href="{{ item.link.url.href }}" class="image-gallery__link" {% if item.link.open_in_new_tab %}target="_blank" rel="noopener"{% endif %}>
          {% elif module.interaction_group.enable_lightbox and item.image.src %}
            <button
              type="button"
              class="image-gallery__lightbox-trigger"
              data-src="{{ item.image.src }}"
              data-alt="{{ item.image.alt|default(item.caption) }}"
              data-caption="{{ item.caption }}"
              aria-label="Open image: {{ item.image.alt|default(item.caption) }}"
            >
          {% endif %}

          <div class="image-gallery__image-wrapper">
            {% if item.image.src %}
              <img
                src="{{ item.image.src }}"
                alt="{{ item.image.alt|default(item.caption) }}"
                class="image-gallery__image"
                loading="lazy"
              >
            {% else %}
              <div class="image-gallery__placeholder">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                  <circle cx="8.5" cy="8.5" r="1.5"></circle>
                  <polyline points="21 15 16 10 5 21"></polyline>
                </svg>
              </div>
            {% endif %}

            {# Hover Overlay Caption #}
            {% if module.interaction_group.show_caption and module.interaction_group.caption_position == "hover" and item.caption %}
              <div class="image-gallery__overlay">
                <span class="image-gallery__caption">{{ item.caption }}</span>
              </div>
            {% endif %}

            {# Lightbox Icon #}
            {% if module.interaction_group.enable_lightbox and item.image.src %}
              <div class="image-gallery__zoom-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="11" cy="11" r="8"></circle>
                  <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                  <line x1="11" y1="8" x2="11" y2="14"></line>
                  <line x1="8" y1="11" x2="14" y2="11"></line>
                </svg>
              </div>
            {% endif %}
          </div>

          {% if has_link %}
            </a>
          {% elif module.interaction_group.enable_lightbox and item.image.src %}
            </button>
          {% endif %}

          {# Below Caption #}
          {% if module.interaction_group.show_caption and module.interaction_group.caption_position == "below" and item.caption %}
            <figcaption class="image-gallery__figcaption">{{ item.caption }}</figcaption>
          {% endif %}
        </figure>
      {% endfor %}
    </div>
  </div>

  {# Lightbox Modal #}
  {% if module.interaction_group.enable_lightbox %}
    <div class="image-gallery__lightbox" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="image-gallery__lightbox-backdrop"></div>
      <div class="image-gallery__lightbox-content">
        <button type="button" class="image-gallery__lightbox-close" aria-label="Close lightbox">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
        <button type="button" class="image-gallery__lightbox-nav image-gallery__lightbox-prev" aria-label="Previous image">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        <button type="button" class="image-gallery__lightbox-nav image-gallery__lightbox-next" aria-label="Next image">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
        <figure class="image-gallery__lightbox-figure">
          <img src="" alt="" class="image-gallery__lightbox-image">
          <figcaption class="image-gallery__lightbox-caption"></figcaption>
        </figure>
      </div>
    </div>
  {% endif %}
</section>
